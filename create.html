<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forge Editor Pro | PlayForge</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg-deep: #0d0d12; --panel-bg: #16161f; --border: #262633; 
            --accent: #6366f1; --text-dim: #94a3b8; 
        }
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: var(--bg-deep); color: white; font-family: 'Inter', sans-serif; }
        
        /* Top Navigation */
        .header { height: 50px; background: var(--panel-bg); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; }
        .tabs-container { display: flex; height: 100%; margin-left: 20px; }
        .tab { padding: 0 20px; display: flex; align-items: center; cursor: pointer; border-right: 1px solid var(--border); font-size: 0.85rem; color: var(--text-dim); transition: 0.2s; }
        .tab.active { background: var(--bg-deep); color: var(--accent); border-bottom: 2px solid var(--accent); }

        .workspace { display: flex; height: calc(100vh - 50px); }

        /* Left Sidebar */
        .sidebar-l { width: 240px; background: var(--panel-bg); border-right: 1px solid var(--border); }
        .p-label { padding: 12px; font-size: 0.7rem; color: #475569; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; }
        .menu-i { padding: 10px 15px; font-size: 0.85rem; color: #cbd5e1; cursor: pointer; display: flex; align-items: center; gap: 10px; border-radius: 4px; margin: 0 8px; }
        .menu-i:hover, .menu-i.active { background: #1e1e2d; color: white; }

        /* Center: Canvas & Logic Sections */
        .content-area { flex: 1; position: relative; overflow: hidden; background: #09090b; }
        #scene-view, #events-view { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; }
        #scene-view.active, #events-view.active { display: flex; align-items: center; justify-content: center; }

        /* Canvas Style */
        .canvas-wrap { position: relative; box-shadow: 0 0 60px rgba(0,0,0,0.5); }
        canvas { background: #000; border: 1px solid #334155; display: block; image-rendering: pixelated; }

        /* Right Sidebar */
        .sidebar-r { width: 300px; background: var(--panel-bg); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .obj-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 15px; }
        .obj-box { background: #1e1e2d; border: 1px solid var(--border); border-radius: 8px; padding: 15px; text-align: center; cursor: grab; font-size: 0.8rem; transition: 0.2s; }
        .obj-box:hover { border-color: var(--accent); background: #252538; transform: translateY(-2px); }

        .props { padding: 15px; background: #11111a; border-radius: 8px; margin: 15px; flex-grow: 1; font-size: 0.85rem; color: var(--text-dim); }
        .p-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid #1e1e2d; padding-bottom: 5px; }
        .p-val { color: white; font-weight: 600; }

        /* Event Editor Table */
        .event-table { width: 100%; color: #cbd5e1; font-size: 0.85rem; border-collapse: collapse; }
        .event-row { border-bottom: 1px solid var(--border); }
        .event-cell { padding: 15px; border: 1px solid var(--border); width: 50%; vertical-align: top; }
        .btn-add { color: var(--accent); cursor: pointer; text-decoration: underline; }

        /* Buttons */
        .btn-pro { padding: 8px 16px; border-radius: 6px; font-weight: 600; border: none; cursor: pointer; font-size: 0.85rem; }
        .primary { background: var(--accent); color: white; }
        .secondary { background: #1e1e2d; color: #94a3b8; border: 1px solid var(--border); }
        .danger { background: #ef4444; color: white; width: 100%; padding: 10px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-weight: 800; letter-spacing: -0.5px; font-size: 1.1rem;">Play<span style="color:var(--accent)">Forge</span></div>
    <div class="tabs-container">
        <div class="tab active" onclick="switchTab('scene')">üè† Main Scene</div>
        <div class="tab" onclick="switchTab('events')">üìú Scene Events</div>
    </div>
    <div style="display: flex; gap: 10px;">
        <button class="btn-pro secondary">Preview</button>
        <button class="btn-pro primary" onclick="publish()">Publish Game</button>
    </div>
</div>

<div class="workspace">
    <aside class="sidebar-l">
        <div class="p-label">Project</div>
        <div class="menu-i active">üìÅ Scenes</div>
        <div class="menu-i">üñº Assets Manager</div>
        <div class="menu-i">‚öôÔ∏è Settings</div>
    </aside>

    <main class="content-area">
        <div id="scene-view" class="active">
            <div class="canvas-wrap">
                <canvas id="gameCanvas" width="800" height="450"></canvas>
            </div>
        </div>

        <div id="events-view">
            <div style="padding: 30px; width: 100%;">
                <h3 style="margin-top:0">Event Sheet</h3>
                <table class="event-table">
                    <tr style="background:#16161f">
                        <th class="event-cell">Conditions (When this happens...)</th>
                        <th class="event-cell">Actions (Do this...)</th>
                    </tr>
                    <tr class="event-row">
                        <td class="event-cell"><span class="btn-add">+ Add Condition</span></td>
                        <td class="event-cell"><span class="btn-add">+ Add Action</span></td>
                    </tr>
                </table>
            </div>
        </div>
    </main>

    <aside class="sidebar-r">
        <div class="p-label">Object Library</div>
        <div class="obj-grid">
            <div class="obj-box" draggable="true" ondragstart="drag(event)" id="sprite">üëæ Sprite</div>
            <div class="obj-box" draggable="true" ondragstart="drag(event)" id="enemy">üü• Enemy</div>
            <div class="obj-box" draggable="true" ondragstart="drag(event)" id="platform">üü¶ Platform</div>
            <div class="obj-box" draggable="true" ondragstart="drag(event)" id="text">T Text</div>
        </div>

        <div class="p-label">Properties</div>
        <div class="props" id="propList">
            Select an object to modify...
        </div>
    </aside>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let objects = [];
    let selected = null;

    // Tab Switching Logic (Fixes your non-working buttons)
    function switchTab(tab) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('scene-view').classList.remove('active');
        document.getElementById('events-view').classList.remove('active');

        if(tab === 'scene') {
            document.querySelector('.tab:nth-child(1)').classList.add('active');
            document.getElementById('scene-view').classList.add('active');
        } else {
            document.querySelector('.tab:nth-child(2)').classList.add('active');
            document.getElementById('events-view').classList.add('active');
        }
    }

    // Drag & Drop
    function drag(ev) { ev.dataTransfer.setData("type", ev.target.id); }
    canvas.addEventListener('dragover', (e) => e.preventDefault());
    canvas.addEventListener('drop', (e) => {
        e.preventDefault();
        const type = e.dataTransfer.getData("type");
        const rect = canvas.getBoundingClientRect();
        const x = Math.round((e.clientX - rect.left - 20) / 25) * 25; // Snapping
        const y = Math.round((e.clientY - rect.top - 20) / 25) * 25;

        const obj = { id: Date.now(), type, x, y, w: 50, h: 50 };
        objects.push(obj);
        render();
        updateProps(obj);
    });

    function render() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // Drawing Grid (Subtle GDevelop feel)
        ctx.strokeStyle = '#1e1e2d';
        for(let i=0; i<canvas.width; i+=25) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }
        for(let j=0; j<canvas.height; j+=25) { ctx.beginPath(); ctx.moveTo(0,j); ctx.lineTo(canvas.width,j); ctx.stroke(); }

        objects.forEach(o => {
            ctx.fillStyle = o.type === 'enemy' ? '#ef4444' : (o.type === 'platform' ? '#3b82f6' : '#6366f1');
            ctx.fillRect(o.x, o.y, o.w, o.h);
            if(selected && o.id === selected.id) {
                ctx.strokeStyle = 'white'; ctx.lineWidth = 2; ctx.strokeRect(o.x, o.y, o.w, o.h);
            }
        });
    }

    function updateProps(obj) {
        selected = obj;
        document.getElementById('propList').innerHTML = `
            <div class="p-row"><span>Type</span> <span class="p-val">${obj.type}</span></div>
            <div class="p-row"><span>X</span> <span class="p-val">${obj.x}px</span></div>
            <div class="p-row"><span>Y</span> <span class="p-val">${obj.y}px</span></div>
            <button class="btn-pro danger" onclick="removeObj(${obj.id})">Remove Object</button>
        `;
        render();
    }

    window.removeObj = (id) => {
        objects = objects.filter(o => o.id !== id);
        selected = null;
        document.getElementById('propList').innerHTML = "Select an object...";
        render();
    };

    function publish() {
        alert("Preparing Forge Project for Upload...");
        localStorage.setItem('playforge_data', JSON.stringify(objects));
        window.location.href = 'publish.html';
    }

    // Initial Render
    render();
</script>
</body>
</html>
